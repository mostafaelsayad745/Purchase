<div class="container">
  <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h2>๐ ุทูุจุงุช ุงูุดุฑุงุก</h2>
      <p class="subtitle">Purchase Requests - Step 3: First Approval</p>
    </div>
    <button class="btn btn-primary" (click)="showCreateForm = !showCreateForm">
      {{ showCreateForm ? 'ุฅุฎูุงุก ุงููููุฐุฌ' : '+ ุฅูุดุงุก ุทูุจ ุดุฑุงุก ูุฏููุงู' }}
    </button>
  </div>

  <!-- Manual Create Form -->
  <div *ngIf="showCreateForm" class="card" style="background: #f8f9fa; margin-bottom: 20px;">
    <h3>ุฅูุดุงุก ุทูุจ ุดุฑุงุก ูุฏููุงู</h3>
    <form (ngSubmit)="createPurchaseRequest()">
      <div class="form-group">
        <label class="form-label">ุทูุจ ุงูุฃุฏุงุฉ *</label>
        <select class="form-control" [(ngModel)]="newPurchaseRequest.toolRequestId" name="toolRequestId" required>
          <option [value]="0">-- ุงุฎุชุฑ ุทูุจ ุงูุฃุฏุงุฉ --</option>
          <option *ngFor="let tr of outOfStockToolRequests" [value]="tr.id">
            {{ tr.toolNameAr }} - ุงููููุฉ: {{ tr.quantityNeeded }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">ุงูููุฒุงููุฉ ุงูููุฏุฑุฉ (ุฑูุงู)</label>
        <input 
          type="number" 
          class="form-control" 
          [(ngModel)]="newPurchaseRequest.estimatedBudget" 
          name="estimatedBudget"
          min="0"
          step="0.01"
        />
      </div>
      <div style="display: flex; gap: 12px; margin-top: 16px;">
        <button type="submit" class="btn btn-success" [disabled]="creating">
          {{ creating ? 'ุฌุงุฑู ุงูุญูุธ...' : 'ุญูุธ ุงูุทูุจ' }}
        </button>
        <button type="button" class="btn" (click)="showCreateForm = false; resetForm()" style="background: #6c757d; color: white;">
          ุฅูุบุงุก
        </button>
      </div>
    </form>
  </div>

  <div class="filter-section">
    <label for="statusFilter">ุชุตููุฉ ุญุณุจ ุงูุญุงูุฉ:</label>
    <select id="statusFilter" [(ngModel)]="selectedStatus" (change)="filterByStatus()">
      <option value="">ุงููู</option>
      <option value="PendingApproval">ูู ุงูุชุธุงุฑ ุงูููุงููุฉ</option>
      <option value="Approved">ููุงูู ุนููู</option>
      <option value="Rejected">ูุฑููุถ</option>
    </select>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>ุฌุงุฑู ุงูุชุญููู...</p>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div *ngIf="!loading && !error" class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>ุฑูู ุงูุทูุจ</th>
          <th>ุงุณู ุงูุฃุฏุงุฉ</th>
          <th>ุงููููุฉ ุงููุทููุจุฉ</th>
          <th>ุชุงุฑูุฎ ุงูุทูุจ</th>
          <th>ุงูุญุงูุฉ</th>
          <th>ุงูููุงูู</th>
          <th>ุชุงุฑูุฎ ุงูููุงููุฉ</th>
          <th>ุงูููุฒุงููุฉ ุงูููุฏุฑุฉ</th>
          <th>ุฅุฌุฑุงุกุงุช</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let request of purchaseRequests">
          <td>{{ request.id }}</td>
          <td class="tool-name">{{ request.toolNameAr }}</td>
          <td>{{ request.quantityNeeded }}</td>
          <td>{{ request.requestDate | date: 'yyyy-MM-dd HH:mm' }}</td>
          <td>
            <span [class]="'badge ' + getStatusClass(request.status)">
              {{ getStatusText(request.status) }}
            </span>
          </td>
          <td>{{ request.approvedByNameAr || '-' }}</td>
          <td>{{ request.approvalDate ? (request.approvalDate | date: 'yyyy-MM-dd HH:mm') : '-' }}</td>
          <td>{{ request.estimatedBudget || '-' }} ุฑูุงู</td>
          <td>
            <div class="action-buttons">
              <button 
                *ngIf="request.status === 'PendingApproval'"
                class="btn btn-success btn-sm"
                (click)="approveRequest(request)"
                title="ุงูููุงููุฉ">
                โ ููุงููุฉ
              </button>
              <button 
                *ngIf="request.status === 'PendingApproval'"
                class="btn btn-danger btn-sm"
                (click)="rejectRequest(request)"
                title="ุฑูุถ">
                โ ุฑูุถ
              </button>
              <button 
                class="btn btn-info btn-sm"
                (click)="viewDetails(request.id)"
                title="ุงูุชูุงุตูู">
                ๐ ุนุฑุถ
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="purchaseRequests.length === 0">
          <td colspan="9" class="no-data">ูุง ุชูุฌุฏ ุทูุจุงุช ุดุฑุงุก</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="info-section">
    <h3>๐ ูุนูููุงุช ุนู ุทูุจุงุช ุงูุดุฑุงุก</h3>
    <ul>
      <li><strong>ุงูุฎุทูุฉ 3:</strong> ุงูููุงููุฉ ุงูุฃููู ุนูู ุทูุจ ุงูุดุฑุงุก</li>
      <li><strong>ุงููุณุคูู:</strong> FirstApprover (ุงูููุงูู ุงูุฃูู)</li>
      <li><strong>ุงูุนูููุฉ:</strong> ูุฑุงุฌุนุฉ ุงูุทูุจ ูุงูููุงููุฉ ุนููู ุฃู ุฑูุถู</li>
      <li><strong>ุงููุชุทูุจุงุช:</strong> ุชุงุฑูุฎ ุงูููุงููุฉุ ูููุฉ ุงูููุงููุ ููุงุญุธุงุช</li>
      <li><strong>ุจุนุฏ ุงูููุงููุฉ:</strong> ุงูุงูุชูุงู ุฅูู ุงูุฎุทูุฉ 4 (ุนุฑูุถ ุงูุฃุณุนุงุฑ)</li>
    </ul>
  </div>
</div>
